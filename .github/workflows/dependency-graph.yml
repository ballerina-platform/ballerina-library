name: Stdlib module dependencies

on: [push]
jobs:
    build:
        name: Derive module dependencies
        runs-on: ubuntu-latest
        steps:
            -   uses: actions/checkout@v2
                with:
                    persist-credentials: false 
                    fetch-depth: 0

            -   name: Setup Python
                uses: actions/setup-python@v2
                with:
                    python-version: '3.x'
            -   name: Generate Dependency Graph
                run: |
                    pip install PyGithub
                    pip install requests
                    python ./release/src/dependencies/main.py
                env:
                    packageUser: ${{ secrets.BALLERINA_BOT_USERNAME }}
                    packagePAT: ${{ secrets.BALLERINA_BOT_TOKEN }}
            -   name: Commit files
                run: |
                    git config --local user.email "action@github.com"
                    git config --local user.name "GitHub Action"
                    git commit -m "Add changes" -a
            -   name: Push changes
                uses: ad-m/github-push-action@master
                with:
                    github_token: ${{ secrets.ACCESS_TOKEN }}
                    branch: ${{ github.ref }}
